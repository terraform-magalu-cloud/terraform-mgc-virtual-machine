# .github/workflows/pre-commit.yml
name: Pre-Commit Checks

on:
  pull_request: # Roda em cada Pull Request para garantir que o código que entra está limpo
    branches:
      - master # Ou a branch principal do seu repositório, por exemplo, 'master'
  workflow_dispatch: # Permite disparar o workflow manualmente

jobs:
  terraform:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set up Terraform
        uses: hashicorp/setup-terraform@v1

      - name: Install terraform-docs
        run: |
          curl -sSL https://github.com/terraform-docs/terraform-docs/releases/download/v0.16.0/terraform-docs-v0.16.0-linux-amd64 -o /usr/local/bin/terraform-docs
          chmod +x /usr/local/bin/terraform-docs

      - name: Install tflint
        run: |
          curl -sSL https://github.com/terraform-linters/tflint/releases/download/v0.33.0/tflint_linux_amd64.zip -o tflint.zip
          unzip tflint.zip
          mv tflint /usr/local/bin/
          chmod +x /usr/local/bin/tflint

      - name: Run pre-commit
        uses: pre-commit/action@v2.0.0
        with:
          extra_args: --all-files
